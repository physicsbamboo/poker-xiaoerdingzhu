# 小二定主游戏规则

## 游戏概述

「小二定主」是一款四人对抗的扑克牌游戏，采用两两配对的方式进行。游戏使用标准54张牌（包括两张大小王）。

## 基本设置

- **玩家数量**: 4人
- **队伍分配**: 
  - 庄家方：玩家1和玩家3
  - 闲家方：玩家2和玩家4
- **牌数**: 54张（♠、♥、♣、♦各13张 + 大小王各1张）
- **发牌**: 每人13张，庄家额外获得2张（共15张）

## 牌型定义

### 主牌（常主）

以下牌**永远**是主牌，不受花色影响：

1. **♦5（方片5）** - 最高主牌
2. **大王（Big Joker）**
3. **小王（Small Joker）**
4. **♠Q（黑桃Q）**

### 等级主牌

- **所有J**: 四张J都是主牌，其中主花色J最强
- **所有2**: 四张2都是主牌，其中主花色2最强

### 花色主牌

游戏开始时确定一个**主花色**（如♥、♣等），该花色的所有牌都是主牌（除了已经是常主的牌）。

### 反牌（三反/五反）

当启用时：
- **五反**: 三张5（除了♦5）成为主牌
- **三反**: 三张3成为主牌

**注意**: 五反的强度 > 三反的强度

## 主牌强度排序（从高到低）

1. ♦5（方片5）
2. 五反（如果启用）
3. 三反（如果启用）
4. 大王
5. 小王
6. ♠Q
7. 主花色J
8. 其他J（按出牌顺序，先出的更强）
9. 主花色2
10. 其他2（按出牌顺序，先出的更强）
11. 其他主花色牌（按正常大小顺序）

## 副牌大小顺序（同花色内）

A > K > Q > 10 > 9 > 8 > 7 > 6 > 5 > 4 > 3 > 2

**注意**: 
- ♠Q是常主，不是副牌
- ♦5是常主，不是副牌

## 出牌规则

### 基本规则

1. **首轮出牌**: 庄家先出第一张牌
2. **后续轮次**: 上一轮获胜者先出牌
3. **每轮出牌**: 每人必须且只能出一张牌

### 跟牌规则

#### 情况1: 首张牌是副牌

如果首张牌是副牌（非主牌），其他玩家必须：

1. **优先跟花色**: 如果有该花色的副牌，必须出该花色的牌
2. **可以毙牌**: 如果没有该花色的副牌，可以出主牌（毙牌）
3. **可以垫牌**: 如果没有该花色的副牌且没有主牌，可以出任意其他副牌（垫牌）

#### 情况2: 首张牌是主牌

如果首张牌是主牌，其他玩家必须：

1. **优先出主牌**: 如果有主牌，必须出主牌
2. **可以垫副牌**: 如果没有主牌，可以出任意副牌

### 获胜判定

每轮（一墩）的获胜者按以下规则确定：

1. **有主牌时**: 出最强主牌的玩家获胜
2. **无主牌时**: 在首张牌的花色内，出最强副牌的玩家获胜

## 计分规则

### 有分值的牌

- **5**: 5分
- **10**: 10分
- **K**: 10分

### 得分计算

- 每轮获胜的玩家所在队伍获得该轮所有牌的分值
- 游戏结束时，统计各队伍获得的总分

## 游戏流程示例

### 示例1: 主牌获胜

```
玩家1（庄家方）出: ♠A（副牌）
玩家2（闲家方）出: ♠K（副牌，跟花色）
玩家3（庄家方）出: ♠10（副牌，跟花色）
玩家4（闲家方）出: ♥J（主牌，毙牌）

结果: 玩家4获胜（主牌 > 副牌）
得分: 该轮无分值牌，得0分
```

### 示例2: 副牌获胜

```
玩家1（庄家方）出: ♠A（副牌）
玩家2（闲家方）出: ♠K（副牌，跟花色）
玩家3（庄家方）出: ♠10（副牌，跟花色）
玩家4（闲家方）出: ♠Q（副牌，跟花色）

结果: 玩家1获胜（A > K > Q > 10）
得分: 该轮无分值牌，得0分
```

### 示例3: 主牌之间比较

```
玩家1（庄家方）出: ♥J（主牌，主花色是♥）
玩家2（闲家方）出: ♠J（主牌）
玩家3（庄家方）出: 小王（主牌）
玩家4（闲家方）出: ♣J（主牌）

结果: 玩家3获胜（小王 > 所有J）
得分: 该轮无分值牌，得0分
```

### 示例4: 有分值牌

```
玩家1（庄家方）出: ♥5（主牌，5分）
玩家2（闲家方）出: ♥10（主牌，10分）
玩家3（庄家方）出: ♥K（主牌，10分）
玩家4（闲家方）出: 大王（主牌）

结果: 玩家4获胜（大王最强）
得分: 玩家4所在队伍（闲家方）获得 5+10+10+0 = 25分
```

## 特殊规则（未来扩展）

以下规则将在后续版本中实现：

### 杠（Gang）

- **真杠**: 四张相同点数的牌
- **假杠**: 三张相同点数的牌 + 一张其他牌

### 甩牌（Shuai Pai）

一次出多张同花色的牌（需要满足特定条件）

### 进贡/还贡（Jin Gong / Huan Gong）

根据上一局结果，输家需要向赢家进贡牌

### 亮牌 & 断电（Liang Pai / Duan Dian）

- **亮牌**: 玩家展示特定牌来确定主花色
- **断电**: 特定条件下主牌失效

### 轮庄（Lun Zhuang）

每局结束后，庄家位置轮换

## 技术实现说明

本游戏引擎使用纯TypeScript实现，不包含UI和网络功能。主要功能包括：

- ✅ 创建游戏和发牌
- ✅ 牌型判断（主牌/副牌）
- ✅ 出牌验证（跟牌规则）
- ✅ 轮次获胜判定
- ✅ 分值计算

### 使用示例

```typescript
import { createNewGame, playCard } from '@/src/game';

// 创建游戏
const config = {
  trumpSuit: '♥',      // 主花色
  hasThreeFan: false,  // 是否启用三反
  hasFiveFan: false,   // 是否启用五反
};

let game = createNewGame(['玩家1', '玩家2', '玩家3', '玩家4'], config);

// 玩家出牌
game = playCard(game, '玩家1', { suit: '♠', rank: 14 }); // 出♠A
```

## 常见问题

**Q: 如果我有主牌，但首张牌是副牌，我必须出主牌吗？**  
A: 不需要。只有当你有该花色的副牌时，才必须跟花色。如果没有，可以选择出主牌（毙牌）或其他副牌（垫牌）。

**Q: 主花色J和副花色J哪个更强？**  
A: 主花色J更强。例如，如果主花色是♥，那么♥J > ♠J = ♣J = ♦J。

**Q: 如果多张相同等级的主牌（如多个J），如何判断？**  
A: 先出的更强。例如，如果两个玩家都出J（非主花色），先出的那个获胜。

**Q: ♦5和五反的5有什么区别？**  
A: ♦5是常主，永远是最强主牌。五反指的是其他花色的5（如♠5、♥5、♣5），当启用五反时，它们也成为主牌，但强度低于♦5。



